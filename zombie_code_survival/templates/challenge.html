{% extends "base.html" %}

{% block content %}
<div class="container challenge-container">
    <div class="challenge-header">
        <div class="level-indicator">SYSTEM {{ challenge.level }}/20</div>
        <div class="error-type">ERROR: {{ challenge.error_type|upper }}</div>
    </div>

    <div>
        <h3>DEBUG THE CODE:</h3>
        <p style="margin-bottom: 15px; color: var(--secondary-text-color);">
            This system contains buggy C++ code. Fix and run it. Use the optional <strong>stdin</strong> field if the
            program reads input.
        </p>
    </div>

    <form method="POST">
        <div class="code-container">
            <textarea name="code" class="code-editor" autocomplete="off" autocorrect="off" autocapitalize="off"
                spellcheck="false">{{ challenge.buggy_code }}</textarea>
        </div>

        <div style="margin: 10px 0;">
            <label style="display:block; margin-bottom:6px; color:var(--main-text-color);">stdin (optional):</label>
            <input name="stdin"
                style="width:100%; padding:10px; border:1px solid var(--border-color); background:rgba(0,0,0,0.5); color:var(--main-text-color);"
                placeholder="e.g. 5">
        </div>

        <button type="submit" class="submit-btn">EXECUTE CODE</button>
    </form>

    {% if session.last_run_phase %}
    <div style="margin-top: 20px;">
        <h4>Execution Results ({{ session.last_run_phase|upper }}):</h4>
        <div class="feedback info">
            <strong>Stdout:</strong>
            <pre style="white-space: pre-wrap;">{{ session.last_run_stdout }}</pre>
        </div>
        <div class="feedback incorrect">
            <strong>Stderr / Compiler:</strong>
            <pre style="white-space: pre-wrap;">{{ session.last_run_stderr }}</pre>
        </div>
    </div>
    {% endif %}

    <div style="margin-top: 30px;">
        <h4>SYSTEM NAVIGATION:</h4>
        <div class="level-grid">
            {% for c in all_challenges %}
            <a href="{{ url_for('main.challenge', level=c.level) }}" class="level-btn 
                {{ 'solved' if c.is_solved }} 
                {{ 'current' if c.level == challenge.level }}
                {{ 'locked' if not c.is_solved and c.level > challenge.level and not challenge.is_solved }}">
                {{ c.level }}
            </a>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}